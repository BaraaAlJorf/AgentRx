--- Arguments Loaded ---
{
    "output_dir": "./results/nospace",
    "agent_setup": "DualAgent",
    "seed": 42,
    "batch_size": 8,
    "num_workers": 4,
    "model_id": "HuggingFaceM4/idefics2-8b",
    "max_new_tokens": 128,
    "data_path": "/scratch/baj321/MedAgent/datasets/multimodal_dataset_splits/val.jsonl",
    "modalities": "EHR-CXR-RR-DN",
    "load_cxr": null,
    "load_ehr": null,
    "load_rr": null,
    "ablation": null,
    "normalizer_state": null,
    "ehr_data_dir": "/scratch/fs999/shamoutlab/data/mimic-iv-extracted",
    "cxr_data_dir": "/scratch/fs999/shamoutlab/data/physionet.org/files/mimic-cxr-jpg/2.0.0",
    "debug_samples": 10
}
--------------------------
Random seed set to: 42
Results will be saved to: ./results/nospace
Data loaded from: /scratch/baj321/MedAgent/datasets/multimodal_dataset_splits/val.jsonl

Starting simulation with agent setup: 'DualAgent'...
Initializing Model and Processor for 'HuggingFaceM4/idefics2-8b'...
✅ Found Canonical Yes ID: 5592, Canonical No ID: 1770
✅ Model 'HuggingFaceM4/idefics2-8b' and Processor loaded successfully.
...Simulation complete.

Evaluating predictions...
...Evaluation complete.

==================================================
      Pipeline Finished Successfully
==================================================

Agent Setup: DualAgent

--- Evaluation Summary ---
{
    "in_hospital_mortality_metrics": {
        "Survived": {
            "precision": 0.8873755893137768,
            "recall": 0.950084127874369,
            "f1-score": 0.9176598049837487,
            "support": 1783.0
        },
        "Mortality": {
            "precision": 0.1523809523809524,
            "recall": 0.06926406926406926,
            "f1-score": 0.09523809523809523,
            "support": 231.0
        },
        "accuracy": 0.8490566037735849,
        "macro avg": {
            "precision": 0.5198782708473646,
            "recall": 0.5096740985692192,
            "f1-score": 0.506448950110922,
            "support": 2014.0
        },
        "weighted avg": {
            "precision": 0.8030738211253545,
            "recall": 0.8490566037735849,
            "f1-score": 0.8233304033197735,
            "support": 2014.0
        },
        "auroc": 0.45955913594724584,
        "auprc": 0.11794572398542001
    },
    "modality_usage_analysis": {
        "total_modality_requests": 3504,
        "average_modalities_per_patient": 1.739821251241311,
        "request_counts": {
            "patient_summary": 2014,
            "ehr_timeseries": 1201,
            "cxr": 289,
            "radiology_report": 0
        },
        "percentage_of_patients_requesting_modality": {
            "patient_summary": 1.0,
            "ehr_timeseries": 0.5963257199602781,
            "cxr": 0.14349553128103276,
            "radiology_report": 0.0
        },
        "percentage_request_when_available": {
            "cxr": 0.6268980477223427,
            "radiology_report": 0.0
        }
    },
    "total_patients_evaluated": 2014
}

Detailed results saved to: ./results/nospace/DualAgent_detailed_results.json
Evaluation summary saved to: ./results/nospace/DualAgent_evaluation_summary.json
